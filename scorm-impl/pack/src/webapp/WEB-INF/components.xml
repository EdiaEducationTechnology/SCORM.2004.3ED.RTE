<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<!-- Bring in the HBM related beans -->
	<import resource="hibernate-hbms.xml" />

	<!-- Bring in the hibernate daos -->
	<import resource="spring-hibernate-daos.xml" />

	<!-- Bring in any other data access objects that are not hibernate related -->
	<import resource="spring-non-hibernate-daos.xml" />

	
	<bean id="org.sakaiproject.scorm.service.api.ADLManager"
		class="org.sakaiproject.scorm.service.impl.ADLManagerImpl"
		singleton="true">
		
		<!-- Data Access Objects -->
		<lookup-method name="contentPackageManifestDao" bean="org.sakaiproject.scorm.dao.api.ContentPackageManifestDao" />
		<lookup-method name="dataManagerDao" bean="org.sakaiproject.scorm.dao.api.DataManagerDao" />
		<lookup-method name="seqActivityTreeDao" bean="org.sakaiproject.scorm.dao.api.SeqActivityTreeDao" />
		
	</bean>
	
	<!-- This bean serves the Scorm API calls -->
	<bean id="org.sakaiproject.scorm.service.api.ScormApplicationService"
		class="org.sakaiproject.scorm.service.impl.ScormApplicationServiceImpl"
		singleton="true">
		
		<!-- Scorm Sequencing Service to manage navigate calls -->
		<lookup-method name="scormSequencingService" bean="org.sakaiproject.scorm.service.api.ScormSequencingService" />
		
		<!-- Local utility bean -->
		<lookup-method name="adlManager" bean="org.sakaiproject.scorm.service.api.ADLManager" />
		
		<!-- Sakai API Service -->
		<lookup-method name="userDirectoryService" bean="org.sakaiproject.user.api.UserDirectoryService" />	  
			  		
		<!-- Data Access Objects -->
		<lookup-method name="attemptDao" bean="org.sakaiproject.scorm.dao.api.AttemptDao" />	  
		<lookup-method name="dataManagerDao" bean="org.sakaiproject.scorm.dao.api.DataManagerDao" />
		
	</bean>
	
	<!-- This bean manages content -->
	<bean id="org.sakaiproject.scorm.service.api.ScormContentService"
		class="org.sakaiproject.scorm.service.impl.ScormContentServiceImpl"
		singleton="true">
		
		<!-- Sakai API Services -->
		<lookup-method name="contentService" bean="org.sakaiproject.content.api.ContentHostingService" /> 
		<lookup-method name="sessionManager" bean="org.sakaiproject.tool.api.SessionManager" />
		<lookup-method name="toolManager" bean="org.sakaiproject.tool.api.ToolManager" />
		<lookup-method name="permissionService" bean="org.sakaiproject.scorm.service.api.ScormPermissionService" />
		
		<!-- Data Access Objects -->
		<lookup-method name="contentPackageDao" bean="org.sakaiproject.scorm.dao.api.ContentPackageDao" />
		<lookup-method name="contentPackageManifestDao" bean="org.sakaiproject.scorm.dao.api.ContentPackageManifestDao" />
		<lookup-method name="dataManagerDao" bean="org.sakaiproject.scorm.dao.api.DataManagerDao" />
		<lookup-method name="seqActivityTreeDao" bean="org.sakaiproject.scorm.dao.api.SeqActivityTreeDao" />
		
		<!-- Content Hosting Handlers -->
		<lookup-method name="scormCHH" bean="org.sakaiproject.scorm.content.api.ScormCHH" />
		
	</bean>	
	
	<bean id="org.sakaiproject.scorm.service.api.ScormPermissionService"
		class="org.sakaiproject.scorm.service.impl.ScormPermissionServiceImpl"
		singleton="true">
		
		<!-- Sakai API Services -->
		<lookup-method name="securityService" bean="org.sakaiproject.authz.api.SecurityService" />
		<lookup-method name="serverConfigurationService" bean="org.sakaiproject.component.api.ServerConfigurationService" />
		<lookup-method name="siteService" bean="org.sakaiproject.site.api.SiteService" />
		<lookup-method name="toolManager" bean="org.sakaiproject.tool.api.ToolManager" />
		<lookup-method name="userDirectoryService" bean="org.sakaiproject.user.api.UserDirectoryService" />	  
		
	</bean>
	
	
	<bean id="org.sakaiproject.scorm.service.api.ScormResultService"
		class="org.sakaiproject.scorm.service.impl.ScormResultServiceImpl"
		singleton="true">
		
		<!-- Sakai API Service -->
		<lookup-method name="userDirectoryService" bean="org.sakaiproject.user.api.UserDirectoryService" />	  
		
		<!-- Data Access Objects -->
		<lookup-method name="attemptDao" bean="org.sakaiproject.scorm.dao.api.AttemptDao" />
		<lookup-method name="dataManagerDao" bean="org.sakaiproject.scorm.dao.api.DataManagerDao" />
	</bean>
	
	<bean id="org.sakaiproject.scorm.service.api.ScormSequencingService"
		class="org.sakaiproject.scorm.service.impl.ScormSequencingServiceImpl"
		singleton="true">
		
		<lookup-method name="scormContentService" bean="org.sakaiproject.scorm.service.api.ScormContentService"/> 
		
		<!-- Sakai API Services -->
		<lookup-method name="sessionManager" bean="org.sakaiproject.tool.api.SessionManager" />
		
		<!-- Local utility bean -->
		<lookup-method name="adlManager" bean="org.sakaiproject.scorm.service.api.ADLManager" />
		
		<!-- Data Access Objects -->
		<lookup-method name="contentPackageManifestDao" bean="org.sakaiproject.scorm.dao.api.ContentPackageManifestDao" />
		<lookup-method name="seqActivityTreeDao" bean="org.sakaiproject.scorm.dao.api.SeqActivityTreeDao" />		
		
	</bean>	
	
	<bean id="org.sakaiproject.scorm.service.api.ScormEntityProvider"
		class="org.sakaiproject.scorm.service.impl.ScormEntityProviderImpl">
		
	</bean>
	
	
	<!-- This is just an ehcache for the content hosting handler below -->
	<bean id="org.sakaiproject.scorm.content.api.ZipCHH.cache" 
		class="org.springframework.cache.ehcache.EhCacheFactoryBean">
  		<property name="cacheManager"><ref bean="org.sakaiproject.memory.api.MemoryService.cacheManager"/></property>
    	<property name="cacheName"><value>org.sakaiproject.scorm.content.api.ZipCHH</value></property>
    	<property name="maxElementsInMemory" ><value>10000</value></property>
    	<property name="diskPersistent" ><value>false</value></property>
    	<property name="eternal" ><value>false</value></property>
   	 	<property name="timeToLive" ><value>300</value></property>
    	<property name="timeToIdle" ><value>600</value></property>
  	</bean>

	<!-- This is the content hosting handler that the component uses to manage content in the
		Sakai content repository so the zip files can be read as virtual file systems -->
	<bean id="org.sakaiproject.scorm.content.api.ScormCHH"
		class="org.sakaiproject.scorm.content.impl.ScormCHH"
		singleton="true"
		init-method="init">
		<lookup-method name="scormContentService" bean="org.sakaiproject.scorm.service.api.ScormContentService"/>
		<lookup-method name="contentService" bean="org.sakaiproject.content.api.ContentHostingService" /> 
		<property name="resolver"><ref bean="org.sakaiproject.content.api.ContentHostingHandlerResolver"/></property>
		<property name="resourceTypeRegistry"><ref bean="org.sakaiproject.content.api.ResourceTypeRegistry"/></property>
		<property name="cache"><ref bean="org.sakaiproject.scorm.content.api.ZipCHH.cache"/></property>
	</bean>
	
	

</beans>